---
title: "Análisis de Componentes Principales"
format: html
editor: visual
---

Para el desarrollo del análisis de componentes principales del conjunto de datos se utilizarán los paquetes de $\texttt{FactoMineR,ade4,FactoClass}$ y $\texttt{factoextra}$. Si bien puede ser redundante el uso de estos 4 paquetes en el mismo código, cada uno de estos ofrece funciones que nos ayudaran a dar una mejor representación gráfica de los resultados obtenidos por el ACP.

De esta forma, se usaran los siguientes paquetes para la ejecución del código.

```{r}
#| label: carga-librerias
#| message: false
#| echo: true
#| output: false

#Manejo de datos
library(tidyverse)
library(readr)
library(dplyr)
library(readxl)
#Gráficos
library(ggplot2)
library(plotly)
library(GGally)
#ACP
library(ade4)
library(FactoClass)
library(FactoMineR)
library(factoextra)
#Datos importados
source("DatosSeleccionados.R")

#Ajustes de tema del documento y graficos
library(scales)
library(DT)
library(gt)
library(RColorBrewer)
theme_set(theme_minimal(base_size = 24, base_family = "Atkinson Hyperlegible"))
library(hrbrthemes)
```

# ACP de todas las variables.

Para comenzar, vamos a considerar todas las variables de tipo cuantitativo de nuestra base de datos para el desarrollo del ACP, en caso de que el lector no recuerde cuáles son dichas variables, pueden ser consultadas [aquí](Datos.qmd).

Ahora, como primer paso, observamos las correlaciones que posee nuestro conjunto de datos a través de su matriz de correlaciones.

```{r}
#| label: Seleccion-variables
#| echo: false
#| warning: false
#| output: false
#http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/#r-packages
#Escogemos las variables cuantitativas
varCuantitativas<-c("EDAD","EDAD_ESCOLARIDAD","NUM_HIJOS","EDAD_CONSUMO_TABACO","EDAD_CONSUMO_ALCOHOL","EDAD_CONSUMO_MARIHUANA","EDAD_CONSUMO_INHALABLES","EDAD_CONSUMO_LSD","EDAD_CONSUMO_HONGOS","EDAD_CONSUMO_COCAINA","EDAD_CONSUMO_PASTA_COCAINA","EDAD_CONSUMO_CRACK","EDAD_CONSUMO_HEROINA","EDAD_CONSUMO_CHOCHOS","EDAD_CONSUMO_TRANQUILIZANTES","EDAD_CONSUMO_ANFETAMINAS","N_PERSONAS_DEPENDIENTES","DINERO_SOBORNO","DELITOS_ABIERTOS","TIEMPO_RECLUIDO","TIEMPO_PROCESO","CANTIDAD_PERSONAS_CELDA","CELDA_HORAS","VECES_SENTENCIADO")

varCualitativas<-setdiff(colnames(Tabla1),c("ID_PER","NOM_ENT",varCuantitativas))

DatosCuantitativos<-Tabla1[,varCuantitativas]
DatosCualitativos<-Tabla1[,varCualitativas]
correlaciones<-cor(DatosCuantitativos)
```

## Matriz de correlación

::: {style="display: flex;"}
::: {style="flex: 1; padding: 7px;"}
```{r}
#| label: Correlaciones
#| title: Correlaciones
#| echo: false
#| warning: false

#http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/#r-packages

correlaciones<-cor(DatosCuantitativos)
#correlaciones<-correlaciones[rev(colnames(correlaciones)),]
TabCorrelaciones<-NULL
for (var1 in colnames(correlaciones)){
  for (var2 in rownames(correlaciones)){
    fila<-data.frame(variable1=var1,variable2=var2,correlacion=correlaciones[var1,var2])
    TabCorrelaciones<-rbind(TabCorrelaciones,fila)
  }
}
TabCorrelaciones<-TabCorrelaciones%>%
  mutate(text = paste0("x: ", TabCorrelaciones$variable1, "\n", "y: ", TabCorrelaciones$variable2, "\n", "Correlacion:",round(correlacion,4)))

options(repr.plot.width =7, repr.plot.height=1)

p <- ggplot(TabCorrelaciones, aes(variable1, variable2, fill= correlacion, text=text)) + labs(x="",y="")+
  geom_tile() +scale_fill_gradient2(low=muted("blue2"),mid="white", high=muted("#F00505"),limits=c(-1,1))+
  theme_ipsum()+theme(
    #axis.text.x=element_text(angle = -90, hjust = 0),
        axis.ticks.x=element_blank(), #remove x axis ticks
        axis.ticks.y=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_blank()
        )  #remove y axis ticks

#par(mar = c(4, 3, 3, 2.5) + 0.1)
par(fin=c(1,1))
#par(mai = c(4, 3, 3, 2.5) + 0.1)
ggplotly(p, tooltip="text")
par(fin=c(1,1))
#heatmap(correlaciones,NA,NA)
```
:::

::: {style="flex: 1; padding: 10px;"}
<font size ="3">

La matriz de correlaciones nos da indicios de la posible relación entre las variables, las cuales se resumen en las siguientes:

</font>

<font size ="2">

-   Las variables que corresponden a la edad a la cual comenzaron a consumir alguna droga o sustancia (Tabaco, alcohol, marihuana, cocaína,...) se encuentran altamente relacionadas.

-   Las variables de TIEMPO_RECLUIDO y TIEMPO_PROCESO, y NUM_HIJOS y N_PERSONAS_DEPENDIENTES se encuentran relacionadas, esto tiene sentido dentro del contexto lógico de lo que representa cada una de estas variables.

-   Las demás variables son independientes, o muy poco relacionadas, entre ellas.

    </font>

Así, se puede esperar que el ACP resultantes tenga a las variables correspondientes a las edades como principales representantes de su primer eje.
:::
:::

Ahora, construiremos el ACP utilizando las funciones `dudi.pca` de `ade4` y `PCA` de `FactoMineR` . Pese a que ambas funciones dan el mismo resultado, los paquetes asociados a estas funciones nos dan alternativas para graficar los resultados obtenidos.

## ACP

```{r}
#| title: ACP de las variables cuantitativas
#| echo: True
#| output: True

res.pca<-FactoMineR:: PCA(DatosCuantitativos, scale.unit = TRUE, ncp = 20, graph = FALSE)
acp <- dudi.pca(DatosCuantitativos, scannf = FALSE, nf = 5) 

# El parámetro nf indica cuantos ejes voy a conservar
valp <- t(inertia(acp)$tot.inertia) # valores propios
kable(valp, digits = 3)
```

::: {style="height: 10%;"}
Como resultado inicial del ACP, se tiene que los 3 primeros ejes capturan un 29.48% de la varianza dada por las variables. Sin embargo, los otros ejes capturan aproximadamente un 5% de varianza, (ver gráfico izquierda); Por lo tanto no es posible resumir de forma drástica la dimensionalidad de la información dada por las variables, lo que puede interpretarse como independencia entre estas.

Esta proposición puede confirmarse a través de los valores propios obtenidos (derecha), donde se obtuvieron 9 valores mayores o iguales a 1, y un total de 14 valores propios cercanos a 1 (mayores a 0.8).
:::

::: {style="height: 20%;"}
::: {layout-ncol="2"}
**Varianza explicada por los ejes**

**Valores propios**

```{r}
#| label: Varianza explicada por los ejes
#| echo: false

#get_eigenvalue(res.pca)# Extract the eigenvalues/variances of principal components
fviz_eig(res.pca,addlabels=T,ylim=c(0,20),ylab = "Porcentaje de varianza explicada",xlab="Eje",main="")# Visualize the eigenvalues
```

```{r}
#| label: Valores propios
#| echo: false

#par(mar = c(2.5, 1, 1, 1.5) + 0.1)
vline <- function(x = 0, color = "green") {
  list(
    type = "line",
    y0 = 0,
    y1 = 1,
    yref = "paper",
    x0 = x,
    x1 = x,
    line = list(color = color, dash="dot")
  )
}
# histograma de valores propios
plot_ly(y=1:length(acp$eig),x=acp$eig,type="bar",orientation="h")%>%layout(plot_bgcolor = "#e5ecf6", shapes = list(vline(1), list(type = "rect",
                                        fillcolor = "red", opacity = 0.2,
                                        x0 = 0.8, x1 = max(acp$eig)+0.2, y0 = -0.5, y1 = 24)))
#par(mar = c(5, 4, 4, 2) + 0.1)
#abline(v = 1, lty = 3)
#kable(acp$co, digits = 3)
#s.corcircle(acp$co)
#plot(acp, Tcol = FALSE, gg = TRUE)
#fig<-ggplotly(p,tooltip = "text")
#fig
#9 ejes
#acp1 <- dudi.pca(DatosCuantitativos, scannf = FALSE, nf = 9) 
#s.corcircle(acp1$co, xax = 5, yax = 8)
```
:::
:::

## Calidad de representación de los ejes.

Ahora que sabemos cuanta varianza es explicada por cada uno de los ejes, también nos es de interés saber cuál es la calidad de representación de las variables en cada uno de los ejes. Para esto, utilizaremos el valor $cos^2(x)$ obtenido para cada eje, esto lo visualizamos por medio de la función `factoextra::fviz_cos2()`.

::: panel-tabset
### 1° eje

```{r}
#| title: Primer eje
#| echo: false
fviz_cos2(res.pca, choice = "var", axes = 1)
```

De este eje, se puede observar que las edades en las cuales se realizó el primer consumo de sustancias psicoactivas son las mas representadas. Siendo las edades de consumo de tabaco y el alcohol los menos representados entre este conjunto de variables.

### 2° eje

```{r}
#| title: Segundo eje
#| echo: false
fviz_cos2(res.pca, choice = "var", axes = 2)
```

En este eje, podemos observar que las 3 variables mejor representadas son la edad de la persona, y las edades en las cuales se consumió por primera vez alcohol y tabaco, lo que complementa al primer eje respecto al consumo de sustancias psicoactivas.

### 3° eje

```{r}
#| title: Tercer eje
#| echo: false
fviz_cos2(res.pca, choice = "var", axes = 3)
```

Este eje se caracteriza por las variables delictivas del tiempo que la persona lleva en el centro penitenciario, cuánto tiempo fue condenado y la cantidad de procesos penales que tiene abierto la persona. Esto tiene sentido, pues en la realidad estas 3 variables se encuentran bastante relacionadas desde su significado.

### 4° eje

```{r}
#| title: Cuarto eje
#| echo: false
fviz_cos2(res.pca, choice = "var", axes = 4)
```

Este eje depende únicamente de 2 variables, las cuales son la cantidad de hijos y de personas dependientes al individuo; la asociación entre estas 2 variables tiene sentido, pues en la mayoría de casos los hijos menores de edad son personas dependientes y viceversa.

### 5° eje

```{r}
#| title: Quinto eje
#| echo: false
fviz_cos2(res.pca, choice = "var", axes = 5)
```

A partir de este eje, las componentes principales tienden a representar principalmente a una sola variable del conjunto de datos, lo que indica la independencia entre las variables.

### 6° eje

```{r}
#| title: Sexto eje
#| echo: false
fviz_cos2(res.pca,choice="var",axes=6)
```

### 7° eje

```{r}
#| title: Septimo eje
#| echo: false
fviz_cos2(res.pca,choice="var",axes=7)
```

El eje 7 es el más próximo respecto a las variables de vida intracarcelaria, pues establece una relación entre la cantidad de horas que una persona permanece en su celda y la cantidad de veces que esta persona ha sido sentenciada a un centro penitenciario. Sin embargo, estos resultados no son confiables debido a la baja varianza que posee este eje.

### 8° eje

```{r}
#| title: Octavo eje
#| echo: false
fviz_cos2(res.pca,choice="var",axes=8)
```

### 9° eje

```{r}
#| title: Noveno eje
#| echo: false
fviz_cos2(res.pca,choice="var",axes=9)
```
:::

De esto, tenemos que los 3 primeros ejes representan (principalmente) los siguientes conjuntos de variables:

-   **1er eje**: Este eje representa la edad a la cual la persona consumió sustancias por primera vez (excepto tabaco y alcohol)

-   **2do eje**: El representa principalmente las edades a la cual la persona consumió tabaco y alcohol por primera vez, junto a la edad de la persona.

-   **3er eje**: Este eje está más relacionado a características delicitivas, pues la calidad de representación es alta para las variables relacionadas al tiempo que lleva dentro de la carcel, el tiempo que fue condenado y la cantidad de procesos abiertos que posee.

## Contribución de cada variable a los ejes

Ahora, de forma similar, utilizamos la función `fviz_contrib` del paquete `factoextra` para observar cuánto contribuye cada una de las variables a la construcción de los ejes.

::: panel-tabset
### 1° eje

```{r}
#| title: Primer eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=1)
```

### 2° eje

```{r}
#| title: Segundo eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=2)
```

### 3° eje

```{r}
#| title: Tercer eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=3)
```

### 4° eje

```{r}
#| title: Cuarto eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=4)
```

### 5° eje

```{r}
#| title: Quinto eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=5)
```

### 6° eje

```{r}
#| title: Sexto eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=6)
```

### 7° eje

```{r}
#| title: Septimo eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=7)
```

### 8° eje

```{r}
#| title: Octavo eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=8)
```

### 9° eje

```{r}
#| title: Noveno eje
#| echo: false
fviz_contrib(res.pca,top=5,choice="var",axes=9)
```
:::

Tenemos que las variables que contribuyen a la construcción de cada uno de los ejes, son las mismas que poseen una mejor calidad de representación.

Con esta información, se puede realizar la siguiente interpretación de los 3 primeros ejes.

1.  **1er eje:** Este eje representa la edad a la cual la persona comienza a consumir cualquier sustancia psicoactiva fuera del alcohol y el tabaco.
2.  **2do eje:** Este eje representa la edad a la cual la persona comienza a consumir alcohol o tabaco.
3.  **3er eje:** Este eje representa el tiempo que la persona debe pasar en el centro penitenciario.

De esta forma, ya podemos realizar una mejor interpretación de los planos factoriales.

## Planos factoriales {height="50%"}

Ahora que poseemos una mejor interpretación de los ejes obtenidos en el ACP. Proyectamos cada una de las variables en el plano factorial para identificar las posibles relaciones entre ellas.

A partir de aquí, consideraremos únicamente las 3 primeras componentes principales, pues las demás componentes representan máximo 2 variables que, por su contexto, se conoce previamente que están relacionadas; además, estas variables no poseen una alto porcentaje de varianza explicada.

::: panel-tabset
### Ejes 1 y 2

```{r}
#| title: Ejes 1-2
#| echo: false

plot.PCA(res.pca,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(1,2))
#fviz_pca_var(res.pca,axes=c(1,2), col.var = "contrib",gradient.cols = c("#FFFFFF", "#E7B800","#08306B"))
```

Concordando con los resultados anteriores, las variables que tratan sobre la edad de consumo de alguna sustancia psicoactiva se encuentran más alineadas a la primera componente principal. También, la edad de la persona y la edad en la que comenzó a consumir tabaco y alcohol se encuentran más alineadas con la segunda componente.

Las demás variables tienen poca contribución a las componentes y se encuentran próximas al centro de la circuferencia, indicando poca o nula representación de estas con las componentes.

### Ejes 2 y 3

```{r}
#| title: Ejes 2-3
#| echo: false

plot.PCA(res.pca,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(2,3))
#fviz_pca_var(res.pca,axes=c(2,3), col.var = "contrib", gradient.cols = c("#FFFFFF", "#E7B800","#08306B"))
```

En este caso, las variables relacionadas al tiempo dentro del centro penitenciario y los delitos cometidos se encuentran más alineadas al 3 eje, encuanto a las edades de consumo de sustancias al segundo eje.

Podemos resaltas que hay sustancias que se encuentran poco representadas por el segundo eje. Finalmente, al igual que en el plano factorial anterior, las demás variables son poco representadas por estas dimensiones.

### Ejes 1 y 3

```{r}
#| title: Ejes 1-3
#| echo: false

plot.PCA(res.pca,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(1,3))
#fviz_pca_var(res.pca,axes=c(1,3), col.var = "contrib",gradient.cols = c("#FFFFFF", "#E7B800","#08306B"))
```

Al igual que en los planos vistos anteriormente, las edades de consumo se relacionan con el primer eje y las variables delictivas con el 3 eje. Aquí observamos que varias variables están próximas de formar un ángulo de 90 grados, lo que implica una independencia entre estas.
:::

## Proyección de los individuos en los planos factoriales {height="\"15%"}

Ahora observaremos cómo se distribuyen los individuos en el espacio generado por las componentes principales obtenidas. Junto a esto, consideraremos también la contribución de cada individuo para saber qué tanto se encuentra representado en las dimensiones seleccionadas.

::: panel-tabset
### Eje 1 y 2

```{r}
#| label: individuos12
#| echo: false
 

fviz_pca_ind(res.pca,col.ind="cos2",geom="point",axes=c(1,2)) +
scale_color_gradient2(low="blue", mid="white", 
                      high="red", midpoint=0.50)+
  theme_minimal()
```

Dado que los ejes están normalizados, este gráfico se puede interpretar por cuadrantes.

-   **Primer cuadrante** El cuadrante superior izquierdo ubica a los individuos que comenzaron a consumir drogas en edades tempranas, pero consumieron tabaco o alcohol en edades tardías (respecto a la media)

-   **Segundo cuadrante** El cuadrante superior derecho ubica a los individuos que comenzaron a consumir drogas, tabaco y alcohol en edades tardías (respecto a la media de la población encuestada).

-   **Tercer cuadrante** El cuadrante inferior izquierdo ubica a los individuos que comenzaron a consumir drogas, tabaco y alcohol en edades tempranas (respecto a la media).

-   **Cuarto cuadrante** El cuadrante inferior derecho ubica a los individuos que comenzaron a consumir alcohol o tabaco en edades tempranas, y drogas a una edad tardía (respecto al promedio del grupo).

Así, vemos que una gran parte de la población se encuentra en el centro o en el primer cuadrante, indicando que una parte considerable de los individuos consumió drogas antes del promedio y alcohol y tabaco después del promedio.

Sin embargo, esto también puede debere a una mala representación de los datos, pues para las personas que nunca han consumido tales sustancias, se les fue asignado un valor de 98/99 en la base de datos lo cual puede estar influenciando en la media de la población, ocasionando estos resultados.

### Eje 2 y 3

```{r}
#| label: individuos23
#| echo: false

fviz_pca_ind(res.pca,col.ind="cos2",geom="point",axes=c(2,3)) +
scale_color_gradient2(low="blue", mid="white", 
                      high="red", midpoint=0.50)+
  theme_minimal()
```

Si bien estas dos dimensiones no son representativas para la gran parte de la población, el eje vertical representa el tiempo que han pasado en el centro penitenciario, y el eje horizontal la edad de consumo de tabaco y alcohol.

Siendo así, la mayoría de la población posee un tiempo dentro del centro penitenciario próximo a la media, a excepción de algunos grupos que están por encima de esta.

### Eje 1 y 3

```{r}
#| label: individuos13
#| echo: false

fviz_pca_ind(res.pca,col.ind="cos2",geom="point",axes=c(1,3)) +
scale_color_gradient2(low="blue", mid="white", 
                      high="red", midpoint=0.50)+
  theme_minimal()
```
:::

Se puede observar que la primera componente principal da una buena representación de un peuqeño grupo de individuos que no han consumnido ningún alucinogeno, pero sí han consumido tabaco y alcohol.

Siendo así, es necesario de más componentes principales para dar una buena representación de la población carcelaria encuestada.

### Grupos en las proyecciones

Ahora consideraremos las posibles subpoblaciones dentro del centro penitenciario a partir de las categorías dadas por variables cualitativas, esto con el objetivo de ver si existen variables categóricas que se vean representadas dentro de las 3 primeras componentes principales.

::: panel-tabset
#### Sexo

```{r}
#| label: GruposACP-Sexo
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$SEXO, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red","black"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

La mayoría de individuos de la población pertenece a la categoría 1 (hombres), pero no hay una división visible entre estas 2 categorías.

#### Edad

```{r}
#| label: GruposACP1 EDAD
#| echo: false

plot.PCA(res.pca,habillage='EDAD',cex=0.5,cex.main=0.5,cex.axis=0.5, label = "none")

```

En este gráfico no se observa un patrón en la escala de color asignada para la edad, lo que indica que la edad no se ve afectada por las 2 primeras componentes principales.

```{r}
#| label: GruposACP1 EDAD2
#| echo: false

plot.PCA(res.pca,habillage='EDAD',cex=0.5,cex.main=0.5,cex.axis=0.5, label = "none",axes=c(2,3))

```

Al observar la segunda y tercera componente principal, se ve un ligero patrón entre los individuos, donde la edad tiene a aumentar a medida que el eje 2 aumenta. Esto tiene sentido, pues la edad y el consumo de tabaco y alcohol son las que mayor se ven representadas por la segunda componente principal.

#### Consumo marihuana

```{r}
#| label: GruposACP1
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$CONSUMO_MARIHUANA, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

Esta puede llegar a ser algo redundante, pues las personas de la categoría 2 (nunca ha consumido marihuana) fue asignada a un valor de 98 o 99 en la edad a la cual consumió esta droga. Por lo tanto, es de esperarse que las personas que no hayan consumido se encuentren en el extremo derecho del primer eje, el cual representa la edad a la cual se consumieron dchas sustancias.

#### Consumo cocaína

```{r}
#| label: GruposACP-Cocaina
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$CONSUMO_COCAINA, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

Ocurre un caso similar al consumo de marihuana.

#### Consumo tabaco

```{r}
#| label: GruposACP-Tabaco
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$CONSUMO_TABACO, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

#### Consumo alcohol

```{r}
#| label: GruposACP-alcohol
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$CONSUMO_ALCOHOL, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

#### Servicio medico

```{r}
#| label: GruposACP-SMedico
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$CELDA_SERVICIO_MEDICO, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red","black"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

Las categorías son las siguientes:

-   **1** El centro penitenciario le proporciona servicios médicos

\-**2** El centro penitenciario no le proporciona servicios médicos

\-**3** No solicitado servicios médicos al centro penitenciario

\-**8** No sabe

\-**9**. No responde

Siendo así, estas variables no presentan ninguna división dada por las 2 dimensiones y se concentran en el centro del plano, indicando una baja representación de los datos.

#### Suicidio

```{r}
#| label: GruposACP-Suicidio
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$CONSIDERO_SUICIDIO, # color by groups
             palette = c("#00AFBB", "#E7B800","#FC4E07","red","black"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

De forma análoga a la variable anterior, las componentes principales no muestran una diferencia significativa para esta categoria. \#### Nivel educativo

```{r}
#| label: GruposACP-Educacion
#| echo: false

fviz_pca_ind(res.pca,
             geom.ind = "point", # show points only (nbut not "text")
             col.ind = Tabla1$NIVEL_ESCOLARIDAD, # color by groups
             #palette = c("#00AFBB", "#E7B800","#FC4E07","red","black"),
             addEllipses = TRUE, # Concentration ellipses
             legend.title = "Groups"
             )
```

No se ve una diferencia significativa para ningún nivel de estudios.
:::

Si bien no se mostraron todas las variables cualitativas de la base de datos, todas las variables poseen un comportamiento similar a las variables mostradas. Los clusters vistos dentro de la población muestran que las componentes principales resumen primordialmente las relaciones entre el consumo de drogas dentro de la población carcelaria.

## Variables cualitativas en los planos factoriales

Ahora realizaremos un análisis similar, considerando el promedio (centro de gravedad) de cada categoría en una variable cualitativa. Para esto, utilizaremos el siguiente plano factorial.

```{r}
#| echo: false
Ysupcat<-Tabla1[setdiff(varCualitativas,c("ANOS_CONDENA","ANOS_PROCESO","MESES_CONDENA","MESES_PROCESO"))]
Ysupcat[]<-lapply(Ysupcat,as.factor)
Ysupcat<-as.data.frame(Ysupcat)
sup<-supqual(acp,Ysupcat)
```

```{r}
#| echo: false

#TIPO_CARCEL 1:3
#TIEMPO_CARCEL 4:10
#SEXO 11:12

#NACION 13:17
#EST_CIVIL 18:26
#HIJOS 27:30
#NIVEL_ESCOLARIDAD 31:42 
#PARO_ESTUDIOS 43:59
#IDENTI_GENERO 60:65
#ORIENT_SEXUAL 66:71
#COVID 72:75
#CONSIDERO_SUICIDIO 76:79
#DISC_VISUAL 80:83
#DISC_AUDITIVA 84:87
#DISC_MOTRIZ 88:91
#CONSUMO_TABACO  92:95
#CONSUMO_ALCOHOL 96:99
#CONSUMO_MARIHUANA 100:103
#CONSUMO_INHALABLES 104:107
#CONSUMO_LSD 108:111
#CONSUMO_HONGOS 112:115
#CONSUMO_COCAINA 116:119
#CONSUMO_PASTA_COCAINA 120:123
#CONSUMO_CRACK 124:127
#CONSUMO_HEROINA 128:131
#CONSUMO_CHOCHOS 132:135
#CONSUMO_TRANQUILIZANTES 136:139
#CONSUMO_ANFETAMINAS 140:143
#VIVE_CON 144:153
#TRABAJO 154:157
#PODIA_COMER 158:161
#DEUDA  162:165
#SALARIO_MES_ANTERIOR 166:174
#MOTIVO_DETENCION 175:181
#TIEMPO_DEL_DET 182:189
#INTENTO_SOBORNO 190: 193
#DECLARACION CULPABLE 194:205
#INTENTO_SOBORNO_JUICIO 206:209
#CELDA_VENTANAS 210:213
#CELDA_AGUA_POTABLE 214:217
#CELDA_DRENAJE 218:221
#CELDA_LUZ 222:225
#CELDA_DUCHA 226: 229
#CELDA_SANITARIO 230: 233
#CELDA_SERVICIO_MEDICO 234:238
#CELDA_ALIMENTOS 239:243
#CARCEL_EJERCICIO 244:247
#CARCEL_LECTURA 248:251
#CARCEL_RELIGION 252: 255
#CARCEL_LLAMADAS 256:259
#CARCEL_ESTUDIO 260:263
#CARCEL_VISITA 264: 267
#CELDA_SEGURIDAD 268: 271
#CARCEL_SEGURIDAD 272:275
#SENTENCIADO_ANTES 276:279
#VIVIO_MADRE_ADOLESCENCIA 280:283
#VIVIO_PADRE_ADOLESCENCIA 284:287
#SALIDA_VIVIENDA 288:291
#SALIDA_EMPLEO 292:295
#SALIDA_ESTUDIO 296:300
#SALIDA_AMIGOS 301:305
#SALIDA_FAMILIA 306:310
#SALIDA_REINCORPORACION 311:315
#COLOR_PIEL 316:326
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[11:12,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
s.arrow(acp$co, add.plot = TRUE, boxes = F)

```

Este es el mismo plano factorial compuesto por los 2 primeros ejes, pero considerado una orientación distinta de estos.

Para el análisis, distinguiremos las variables seleccionadas por la clasificación hecha previamente de variables sociodemográficas, económicas, delictivas y de vida intracarcelaria.

### Variables sociodemográficas

::: panel-tabset
#### Sexo

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[11:12,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[11:12,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[11:12,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[11:12,], col = 6, pch = 16)
text(sup$coor[11:12,], labels = rownames(sup$coor[11:12,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** En promedio, las mujeres de los centro penitenciarios comienzan el consumo de sustacias psicoactivas, alcohol y tabaco en edades más tardías que los hombres.

#### Nivel educativo

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[31:42,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[31:42,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[31:42,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[31:42,], col = 6, pch = 16)
text(sup$coor[31:42,], labels = rownames(sup$coor[31:42,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** En promedio, a medida que aumenta el nivel educativo, el consumo de sustancias psicoactivas, tabaco y alcohol comienza de forma más tardía.

#### Paro estudios

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[43:59,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[43:59,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[43:59,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[43:59,], col = 6, pch = 16)
text(sup$coor[43:59,], labels = rownames(sup$coor[43:59,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación**

Las categorías de estas variables son las siguientes:

-   01: Porque no quise/ no me interesa.
-   02: Porque no se me da/ me resultaba difícil.
-   03: Prefería hacer otras actividades de ocio \[estar con amigos o novio(a), vagar, etc.\]
-   04: Por realizar actividades ilegales
-   05: No tenía dinero
-   06: Me suspendieron o expulsaron de la escuela.
-   07:Tenía que trabajar
-   08: Porque no tenía papeles/documentos.
-   09: Porque me casé/me embaracé o embaracé a mi pareja.
-   10: Porque me detuvieron, caí en la cárcel.
-   11: Porque salí de la cárcel.
-   12: Porque tenía que ayudar con las labores del hogar.
-   13: Por problemas de salud.
-   14: Porque me drogaba o tomaba.
-   98: No sabe
-   99: No responde

El gráfico mostrado muestra que, en promedio, la población carcelaria mexicana comenzó el consumo de sustancias a edades tempranas paró sus estudios debido a problemas en la escuela, falta de interés o problemas delicitivos.

#### Consumo alcohol

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[96:99,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[96:99,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[96:99,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[96:99,], col = 6, pch = 16)
text(sup$coor[96:99,], labels = rownames(sup$coor[96:99,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Al igual que las agrupaciones anteriores hechas respecto a las variables de consumo de sustancias, esta clasificación puede llegar a ser redundante.

Como información adicional, este gráfico nos dice que, en promedio, las personas que han consumido alcohol tienden a consumir en edades más tempranas otras sustancias a compración de los que no han consumido alcohol, los cuales comienzan a consumir sustancias en edades mucho más tardías.

#### Consumo marihuana

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[100:103,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[100:103,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[100:103,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[100:103,], col = 6, pch = 16)
text(sup$coor[100:103,], labels = rownames(sup$coor[100:103,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** La información nueva dada por este gráfico es similar al caso del alcohol, las personas del centro penitenciario que consumieron marihuana comenzaron a consumir tabaco y alcohol en edades más tempranas que los que no consumen esta droga.
:::

### Variables económicas

::: panel-tabset
#### Salario mes anterior

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[166:174,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[166:174,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[164:174,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[166:174,], col = 6, pch = 16)
text(sup$coor[166:174,], labels = rownames(sup$coor[166:174,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Todas las categorías están concentradas en el centro del plano, lo que indica que todas estas son pocos representadas en el plano factorial.

Analizando el significado de cada variable, esto tiene sentido, pues los ejes representan la edad a la cual la persona comenzó a consumir sustancias psicoactivas (algo que pudo ser hace años), por lo cual es de esperarse que guarde poca relación con el salario que ganó su último mes antes de ser sentenciado.

#### Deuda

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[158:161,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[158:161,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[158:161,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[158:161,], col = 6, pch = 16)
text(sup$coor[158:161,], labels = rownames(sup$coor[158:161,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Dado que las categorias se ubican en el centro del plano, esto da a entender que no poseer deudas o no, no se encuentra representado por la edad de inicio de consumo de sustancias.

#### Comida

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[162:165,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[162:165,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[162:165,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[162:165,], col = 6, pch = 16)
text(sup$coor[162:165,], labels = rownames(sup$coor[162:165,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Dado que las categorias se ubican en el centro del plano, esto da a entender que no poseer deudas o no, no se encuentra representado por la edad de inicio de consumo de sustancias.
:::

### Variables delictivas

::: panel-tabset
#### Sentenciado antes

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[276:279,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[276:279,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[276:279,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[276:279,], col = 6, pch = 16)
text(sup$coor[276:279,], labels = rownames(sup$coor[276:279,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** La segunda componente principal parece no tener relación con la variable. La primera componente principal. Es decir, en promedio, las personas que ya habían sido sentenciadas por algun crimen antes, comenzaron a consumir sustancias psicoactivas en edades más tempranas que las personas que no habían sentenciadas.

#### Motivo de detención

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[175:181,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[175:181,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[175:181,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[175:181,], col = 6, pch = 16)
text(sup$coor[175:181,], labels = rownames(sup$coor[175:181,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Las categorias parecen tener poca influencia por la edad de inicio de consumo de sustancias, tabaco y alcohol.

Las categorias de esta variable son:

-   01: Porque reconocí los hechos de manera voluntaria
-   02: Porque me lo recomendó mi abogado
-   03: Porque me lo recomendó alguien en el Ministerio Público
-   04: Porque me presionaron o amenazaron para hacerlo
-   05: Porque me agredieron físicamente
-   06: Para proteger a alguien más
-   07: Porque los interrogatorios fueron muy extensos
-   08: Porque me dijeron que podría salir libre.
-   09: Porque me convencieron de que era culpable
-   98: No sabe
-   99: No responde

Si bien la varianza explicada de los ejes no es la suficiente para interpretar como una relación significativa, se tiene que las personas que reconocieron los hechos de forma voluntaria comenzaron a consumir sustancias psicoactivas a edades más tempranas.
:::

### Variables de la vida intracarcelaria

::: panel-tabset
#### Seguridad en la carcel

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[272:275,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[272:275,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[272:275,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[272:275,], col = 6, pch = 16)
text(sup$coor[272:275,], labels = rownames(sup$coor[272:275,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Dadas las distancias de cada categoría al centro y entre ellas, se tiene que la sensación de seguridad en el centro penitenciario no se ve influenciada por la edad a la que comenzó a consumir sustancias.

Esto es de esperarse, pues la sensación de seguridad depende de factores relacionados al cuidado y condiciones de vida actuales dentro de la prisión.

#### Estudio

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[260:263,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[260:263,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[260:263,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[260:263,], col = 6, pch = 16)
text(sup$coor[260:263,], labels = rownames(sup$coor[260:263,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Dadas las distancias entre cada categoría al centro y entre ellas, podemos decir que esta variable categórica no guarda relación con la edad de inicio de consumo de sustancias.

#### Reincorporación

Los pesos, distancias al cuadrado y las nuevas coordenadas son:

```{r}
#| echo: false
pes_dist_coor<-cbind(wcat = sup$wcat, d2 = sup$dis2, sup$coor)
kable(pes_dist_coor[311:315,], 
      digits = 3)
```

Los valores test y los cosenos cuadrados son:

```{r}
#| echo: false
test_cos<-cbind(sup$tv, sup$cos2)
kable(head(test_cos[311:315,]), digits = 3)
```

```{r}
#| echo: false
plot(acp, Tcol = FALSE, ucal = 100, cex.row = 0,
     xlim = c(min(sup$coor[311:315,]-0.2),1), ylim = c(-1, 1), plot.axes = FALSE)
#s.arrow(acp$co, add.plot = TRUE, boxes = F)
points(sup$coor[311:315,], col = 6, pch = 16)
text(sup$coor[311:315,], labels = rownames(sup$coor[311:315,]),
     col = 6, pos = 1, font = 3, srt=-45)
```

**Interpretación** Dadas las distancias entre cada categoría al centro y entre ellas, podemos decir que esta variable categórica no guarda relación con la edad de inicio de consumo de sustancias.
:::

En resumen, algunas de las variables socioeconómicas poseen relaciones con las 2 primeras componentes principales,las cuales están asociadas a las edades en las cuales la persona consumió por primera vez alcohol, tabaco o sustancias psicoactivas, lo que concuerda con la literatura y otros estudios similares.

Por otro lado,las variables económicas, delictivas y de vida intracarcelaria no mostraron alguna relación entre sus categorías y dichas componentes. Esto es de esperarse en la mayoría de variables, pues desde un razonamiento contextual, es poco probable que la edad de inicio de consumo de sustancias dé información actual sobre las condiciones de vida de la persona; si bien el consumo de sustancias puede tener relación con estas variables, existen características sobre el consumo de sustancias que son más representativas del estilo de vida de la persona. Por ejemplo, la frecuencia de consumo.

Aún así, es posible que estas variables guarden relación con la tercera componente principal, la cual trata sobre el tiempo que la persona lleva dentro del centro penitenciario.

# ACP sin considerar el consumo de sustancias psicoactivas

Dado que de las 24 variables seleccionadas para el ACP, 13 de ellas se refieren a la edad de consumo de algún psicoactivo, y las demás variables son muy diversas en torno a la vida de la población privada de la libertad, se planteó la idea de separar estas variables en dos grupos para la construcción de dos ACP.

En este enfoque, las variables que no se analizarían directamente se evaluarían como variables ilustrativas. Esto facilita la lectura del ACP, ya que separa las variables relacionadas a la edad del consumo de sustancias y evita que distorsionen la interpretación de los demás ejes y sus relaciones. Además, dado que de los análisis bivariados previos mostraron que la variable EDAD tiene una alta correlación con la mayoría de las otras variables, se decidió mantener esta variable como la única común en ambos ACPs. Finalmente, al comparar los resultados de ambos ACPs con los del ACP que incluye todas las variables, se observó que los resultados eran prácticamente los mismos. Por lo tanto, se optó por presentar los dos ACPs separados, ya que permiten interpretar la información de forma clara y comprensible.

En principio, dentro de la base de datos existen varios datos atípicos que representan no sabe/ no responde por parte de los individuos, esto se puede corroborar con lo publicado en el [informe operativo por parte del INEGI](Antecedentes.qmd). Dado que no es factible identificar y establecer como ilustrativas este tipo de individuos, se analiza el ACP con estos sabiendo que muy seguramente los individuos más atípicos sean aquellos que no dieron una respuesta clara (puesto que son uno de los valores 98 o 99).

```{r}
#| label: Seleccion-variables2
#| echo: false
#| warning: false
#| output: false
#http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/#r-packages
#Escogemos las variables cuantitativas
varCuantitativas2<-c("EDAD","NUM_HIJOS","N_PERSONAS_DEPENDIENTES","DINERO_SOBORNO","DELITOS_ABIERTOS","TIEMPO_RECLUIDO","TIEMPO_PROCESO","CANTIDAD_PERSONAS_CELDA","CELDA_HORAS","VECES_SENTENCIADO")


DatosCuantitativos2<-Tabla1[,varCuantitativas2]
DatosCualitativos2<-Tabla1[,varCualitativas]
```

Los resultados iniciales del ACP al excluir las variables de consumo de sustancias son los siguientes.

```{r}
#| title: ACP de las variables cuantitativas
#| echo: False
#| output: True

res.pca2<-FactoMineR:: PCA(DatosCuantitativos2, scale.unit = TRUE, ncp = 20, graph = FALSE)
acp2 <- dudi.pca(DatosCuantitativos2, scannf = FALSE, nf = 5) 

# El parámetro nf indica cuantos ejes voy a conservar
valp <- t(inertia(acp2)$tot.inertia) # valores propios
kable(valp, digits = 3)
```

Como primera diferencia, obtenemos uniformidad en la varianza explicada por cada eje, donde cada eje explica un 10%, lo que indica la poca relación que poseen estas variables.

::: panel-tabset
## Varianza explicada

```{r}
#| title: Varianza explicada
#| label: varianza ACP2
#| echo: false
fviz_eig(res.pca2,addlabels=T,ylim=c(0,20),ylab = "Porcentaje de varianza explicada",xlab="Eje",main="")

```

## Valores propios

```{r}
#| label: Valores propios2
#| echo: false

#par(mar = c(2.5, 1, 1, 1.5) + 0.1)
vline <- function(x = 0, color = "green") {
  list(
    type = "line",
    y0 = 0,
    y1 = 1,
    yref = "paper",
    x0 = x,
    x1 = x,
    line = list(color = color, dash="dot")
  )
}
# histograma de valores propios
plot_ly(y=1:length(acp2$eig),x=acp2$eig,type="bar",orientation="h")%>%layout(plot_bgcolor = "#e5ecf6", shapes = list(vline(1), list(type = "rect",
                                        fillcolor = "red", opacity = 0.2,
                                        x0 = 0.8, x1 = max(acp2$eig)+0.2, y0 = -0.5, y1 = 14)))
```
:::

Dados estos valores, es casi un hecho la independencia entre las variables. Los primeros ejes factoriales resumen la posible correlación que estas variables puedan obtener.

Ahora veremos cómo están compuestos estos ejes.

::: panel-tabset
### Eje 1

```{r}
#| label: a1
#| echo: false
fviz_cos2(res.pca2, choice = "var", axes = 1)
```

### Eje 2

```{r}
#| label: a2
#| echo: false
fviz_cos2(res.pca2, choice = "var", axes = 2)
```

### Eje 3

```{r}
#| label: a3
#| echo: false
fviz_cos2(res.pca2, choice = "var", axes = 3)
```

### Eje 4

```{r}
#| label: a4
#| echo: false
fviz_cos2(res.pca2, choice = "var", axes = 4)
```
:::

El primer eje, al igual que el tercer eje de nuestro primer ACP, contiene información del tiempo de condena de la persona, en cuanto al segundo y tercer eje, estos consisten en la cantidad de personas dependientes al individuo y, finalmente, el cuarto eje obtiene la relación entre la cantidad de personas y el tiempo que la persona pasa en su celda. Los demás ejes consisten en una sola variable, por lo cual no se contemplan en este análisis.

Para fines prácticos, nos centraremos de nuevo en los 3 primeros componentes principales.

## Planos factoriales

::: panel-tabset
### Ejes 1 y 2

```{r}
#| title: ACP2 Ejes 1-2
#| echo: false

plot.PCA(res.pca2,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(1,2))
#fviz_pca_var(res.pca2,axes=c(1,2), col.var = "contrib", gradient.cols = c("#FFFFFF","#E7B800","#08306B"))
```

### Ejes 2 y 3

```{r}
#| title: ACP2 Ejes 2-3
#| echo: false

plot.PCA(res.pca2,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(2,3))

#fviz_pca_var(res.pca2,axes=c(2,3), col.var = "contrib",
             #gradient.cols =c("#FFFFFF","#E7B800","#08306B")
             #)
```

### Ejes 1 y 3

```{r}
#| title: ACP 2 Ejes 1-3
#| echo: false

plot.PCA(res.pca2,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(1,3))
#fviz_pca_var(res.pca2,axes=c(1,3),col.var = "contrib",gradient.cols = c("#FFFFFF", "#E7B800","#08306B"))
```
:::

El primer eje puede utilizarse como indicador para evaluar el estado del individuo, ya que del análisis bivariado se evidencia que son estados excluyentes, luego tiene sentido que los individuos más a la derecha están en proceso de ingreso dado que se le evalúan sus delitos abiertos. Diferente a los de la izquierda que ya pasaron el tiempo de proceso de ingreso y están cumpliendo tiempo en reclusión.

A su vez se encuentra una relación entre la edad y el tiempo recluido, esto da indicios de que los reclusos con mayor tiempo de condena tienden a ser también de mayor edad.

Por otro lado el segundo eje se encuentra en gran relación entre las personas con hijos y aquellas con personas dependientes, ambas variables con alta contribución para este factor, luego es un gran indicador para identificar a personas privadas de la libertad responsables de individuos más vulnerables.

El tercer eje no otorga mucha información, pues representa mayoritariamente la edad del individuo.

Estas observaciones pueden confirmarse al observar la distribución de los individuos en los planos factoriales.

## Proyección de los individuos

::: panel-tabset
### Eje 1 y 2

```{r}
#| label: individuos12 ACP2
#| echo: false
 
plot.PCA(res.pca2, habillage='EDAD', label = "none",axes = c(1,2))
#fviz_pca_ind(res.pca2,geom="point",axes=c(1,2))
```

Las edades aumentan hacia la izquierda. Lo que indica la relación entre la edad y el tiempo de reclusión.

### Eje 2 y 3

```{r}
#| label: individuos23 ACP2
#| echo: false

plot.PCA(res.pca2, habillage='NUM_HIJOS', label = "none",axes=c(2,3))
#fviz_pca_ind(res.pca2,geom="point",axes=c(2,3))
```

La población con hijos se encuentra aislada de los demás.

### Eje 1 y 3

```{r}
#| label: individuos13 ACP2
#| echo: false

plot.PCA(res.pca2, habillage='EDAD', label = "none",axes = c(1,3))
#fviz_pca_ind(res.pca2,geom="point",axes=c(1,3))
```

Se obtiene un crecimiento diagonal en los ejes, lo que indica que los dos ejes representan a la edad.
:::

# ACP considerarando únicamente las edad y el consumo de sustancias psicoactivas

Ahora consideraremos únicamente lsa variables relacionadas al consumo de sustancias psicoactivas. Dado que estas variables fueron las más representadas en el primer ACP (donde consideramos todas las variables), es de esperarse que se obtengan los mismos resultados.

En ese caso, la interpretación hecha en un inicio estaría acertada, pues no estaría siendo afectada por otras variables cuantitativas.

```{r}
#| label: Seleccion-variables3
#| echo: false
#| warning: false
#| output: false
#http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/#r-packages
#Escogemos las variables cuantitativas
varCuantitativas3<-varCuantitativas<-c("EDAD","EDAD_CONSUMO_TABACO","EDAD_CONSUMO_ALCOHOL","EDAD_CONSUMO_MARIHUANA","EDAD_CONSUMO_INHALABLES","EDAD_CONSUMO_LSD","EDAD_CONSUMO_HONGOS","EDAD_CONSUMO_COCAINA","EDAD_CONSUMO_PASTA_COCAINA","EDAD_CONSUMO_CRACK","EDAD_CONSUMO_HEROINA","EDAD_CONSUMO_CHOCHOS","EDAD_CONSUMO_TRANQUILIZANTES","EDAD_CONSUMO_ANFETAMINAS")


DatosCuantitativos3<-Tabla1[,varCuantitativas3]
```

El porcentaje de varianza explicada es mayor al obtenido inicialmente, sin embargo, se mantienen valores próximos, lo que da indicios de que las relaciones obtenidas en el primer ACP fueron acertadas.

```{r}
#| title: ACP de las variables de sustancias
#| echo: False
#| output: True

res.pca3<-FactoMineR:: PCA(DatosCuantitativos3, scale.unit = TRUE, ncp = 20, graph = FALSE)
acp3 <- dudi.pca(DatosCuantitativos3, scannf = FALSE, nf = 5) 

# El parámetro nf indica cuantos ejes voy a conservar
valp <- t(inertia(acp2)$tot.inertia) # valores propios
kable(valp, digits = 3)
```

Se obtuvo una reducción en los valores propios mayores o iguales a 1, además de un aumento de 7% en la varianza explicada por las primeras 3 componentes.

::: panel-tabset
## Varianza explicada

```{r}
#| label: varianza ACP3
#| echo: false

fviz_eig(res.pca3,addlabels=T,ylim=c(0,20),ylab = "Porcentaje de varianza explicada",xlab="Eje",main="")

```

## Valores propios

```{r}
#| label: Valores propios3
#| echo: false

#par(mar = c(2.5, 1, 1, 1.5) + 0.1)
vline <- function(x = 0, color = "green") {
  list(
    type = "line",
    y0 = 0,
    y1 = 1,
    yref = "paper",
    x0 = x,
    x1 = x,
    line = list(color = color, dash="dot")
  )
}
# histograma de valores propios
plot_ly(y=1:length(acp3$eig),x=acp3$eig,type="bar",orientation="h")%>%layout(plot_bgcolor = "#e5ecf6", shapes = list(vline(1), list(type = "rect",
                                        fillcolor = "red", opacity = 0.2,
                                        x0 = 0.8, x1 = max(acp3$eig)+0.2, y0 = -0.5, y1 = 17)))
```
:::

##Planos factoriales

::: panel-tabset
### Ejes 1 y 2

```{r}
#| title: ACP3 Ejes 1-2
#| echo: false

plot.PCA(res.pca3,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(1,2))
#fviz_pca_var(res.pca2,axes=c(1,2), col.var = "contrib", gradient.cols = c("#FFFFFF","#E7B800","#08306B"))
```

### Ejes 2 y 3

```{r}
#| title: ACP3 Ejes 2-3
#| echo: false

plot.PCA(res.pca3,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(2,3))

#fviz_pca_var(res.pca2,axes=c(2,3), col.var = "contrib",
             #gradient.cols =c("#FFFFFF","#E7B800","#08306B")
             #)
```

### Ejes 1 y 3

```{r}
#| title: ACP3 Ejes 1-3
#| echo: false

plot.PCA(res.pca3,choix='var',habillage = 'contrib',cex=0.6,cex.main=0.9,cex.axis=0.9,axes = c(1,3))
#fviz_pca_var(res.pca2,axes=c(1,3),col.var = "contrib",gradient.cols = c("#FFFFFF", "#E7B800","#08306B"))
```
:::

Al igual que en el primer ACP:

-   La primera componente sugiere ser un indicador de a qué edad se consumió por primera vez algún alucinógeno, por parte de las personas privadas de la libertad.

-   La segunda componente aún representa al tabaco y alcohol, mas parece dar una organización de los alucinógenos de "mayor facilidad de adquisición" a los menos comunes o más raros.

-   Debido a que no están las variables delictivas, la 3 componente principal es un indicador de edad de la población privada de la libertad

Al observar las proyecciones de los individuos en el plano, podemos identificar los mismos patrones y establecer que obtendremos resultados similares a los obtenidos al considerar todas las variables.

## Proyección de los individuos

::: panel-tabset
### Eje 1 y 2

```{r}
#| label: individuos12 ACP3
#| echo: false
 
plot.PCA(res.pca3, habillage='EDAD', label = "none",axes = c(1,2))
#fviz_pca_ind(res.pca2,geom="point",axes=c(1,2))
```

### Eje 2 y 3

```{r}
#| label: individuos23 ACP3
#| echo: false

plot.PCA(res.pca3, habillage='EDAD', label = "none",axes=c(2,3))
#fviz_pca_ind(res.pca2,geom="point",axes=c(2,3))
```

### Eje 1 y 3

```{r}
#| label: individuos13 ACP3
#| echo: false

plot.PCA(res.pca3, habillage='EDAD', label = "none",axes = c(1,3))
#fviz_pca_ind(res.pca2,geom="point",axes=c(1,3))
```
:::
