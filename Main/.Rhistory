kable(Val_test_Cuanti[["4"]]) %>%kable_styling("striped", full_width = T)
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["4"]]) %>%kable_styling("striped", full_width = T)
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["4"]]) %>%kable_styling("striped", full_width = T)
#| label: valuestCuali2 grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["1"]]) %>% kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuestCuanti grupo2
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["2"]])%>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: numero-grupos
#| code-fold: show
grupos_jerarquicos <- cutree(hclCafe, k=7)
#| label: consolidacion
#| code-fold: true
set.seed(1311) #Fijamos semilla
centros_de_gravedad <- aggregate(pregroup$centers, by = list(grupos_jerarquicos), FUN = mean) #Calculamos los centros de gravedad obtenidos para los 5000 grupos
kmeans_consolidacion <- kmeans(pregroup$centers, centers = centros_de_gravedad[, -1]) #Iniciamos kmeans con los centros de gravedad calculados
ordenados <- order(rowSums(kmeans_consolidacion$centers))
# Crear una nueva asignación de grupos reordenada
consolidacion <- match(kmeans_consolidacion$cluster, ordenados)
Grupos<-consolidacion[pregroup$cluster] #Obtenemos los grupos finales
#Grupos<-kmeans_consolidacion$cluster[pregroup$cluster] #Obtenemos los grupos finales
#| label: Selección1
#| echo: false
#| message: false
#| warning: false
#| output: true
#Variables seleccionadas en el ACM
Var_cuali_intra<-c(
"CAR_PERSONAS_CELDA",
"CELDA_VENTANAS",
"CELDA_AGUA_POTABLE" ,
"CELDA_DRENAJE",
"CELDA_LUZ",
"CELDA_DUCHA" ,
"CELDA_SANITARIO" ,
"CELDA_SERVICIO_MEDICO",
"CELDA_ALIMENTOS",
"CARCEL_EJERCICIO",
"CARCEL_LECTURA" ,
"CARCEL_RELIGION" ,
"CARCEL_LLAMADAS" ,
"CARCEL_ESTUDIO" ,
"CARCEL_VISITA" ,
"CELDA_SEGURIDAD" ,
"CARCEL_SEGURIDAD",
"TIPO_CARCEL",
"TIEMPO_CARCEL",
"ORIENT_SEXUAL",
"SEXO"
)
DatosCualiIntra<-Tabla1[,Var_cuali_intra]
DatosCualiIntra[]<-lapply(DatosCualiIntra, as.factor)
kable(head(DatosCualiIntra, 10))
#| label: carga-librerias
#| message: false
#| code-fold: show
#| output: false
#Manejo de datos
library(tidyverse)
library(readr)
library(dplyr)
library(readxl)
#Gráficos
library(ggplot2)
library(gridExtra)
library(plotly)
library(GGally)
#ACP
library(ade4)
library(FactoClass)
library(FactoMineR)
library(factoextra)
#Datos importados
source("DatosSeleccionados.R")
#Ajustes de tema del documento y graficos
library(scales)
library(DT)
library(gt)
library(RColorBrewer)
theme_set(theme_minimal(base_size = 24, base_family = "Atkinson Hyperlegible"))
library(hrbrthemes)
options(scipen=999) #Evitar notación científica
#| label: AsignacionGrupos
#| echo: false
Y<-as.data.frame(Y)
Y[["GrupoFinal"]]<-as.factor(Grupos)
DatosCualiIntra<-cbind(DatosCualiIntra,Y["GrupoFinal"])
Tabla1<-cbind(Tabla1,Y["GrupoFinal"])
valores_test<-cluster.carac(DatosCualiIntra[,1:21], DatosCualiIntra$GrupoFinal)
#| label: PorcentajesGrupos
#| echo: false
kable(table(DatosCualiIntra$GrupoFinal)/nrow(DatosCualiIntra)*100)
#| label: valuest grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["1"]]) %>% kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo2
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["2"]])%>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo3
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["3"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["4"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: graficoperfilessexo
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$SEXO)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesagua
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_AGUA_POTABLE)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilescelda
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CAR_PERSONAS_CELDA)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesEjercicio
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CARCEL_LECTURA)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesVentanas
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_VENTANAS)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesTipoCarcel
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIPO_CARCEL)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: carga-librerias
#| message: false
#| code-fold: show
#| output: false
#Manejo de datos
library(tidyverse)
library(readr)
library(dplyr)
library(readxl)
#Gráficos
library(ggplot2)
library(gridExtra)
library(plotly)
library(GGally)
#ACP
library(ade4)
library(FactoClass)
library(FactoMineR)
library(factoextra)
#Datos importados
source("DatosSeleccionados.R")
#Ajustes de tema del documento y graficos
library(scales)
library(DT)
library(gt)
library(RColorBrewer)
theme_set(theme_minimal(base_size = 24, base_family = "Atkinson Hyperlegible"))
library(hrbrthemes)
options(scipen=999) #Evitar notación científica
#| label: Selección1
#| echo: false
#| message: false
#| warning: false
#| output: true
#Variables seleccionadas en el ACM
Var_cuali_intra<-c(
"CAR_PERSONAS_CELDA",
"CELDA_VENTANAS",
"CELDA_AGUA_POTABLE" ,
"CELDA_DRENAJE",
"CELDA_LUZ",
"CELDA_DUCHA" ,
"CELDA_SANITARIO" ,
"CELDA_SERVICIO_MEDICO",
"CELDA_ALIMENTOS",
"CARCEL_EJERCICIO",
"CARCEL_LECTURA" ,
"CARCEL_RELIGION" ,
"CARCEL_LLAMADAS" ,
"CARCEL_ESTUDIO" ,
"CARCEL_VISITA" ,
"CELDA_SEGURIDAD" ,
"CARCEL_SEGURIDAD",
"TIPO_CARCEL",
"TIEMPO_CARCEL",
"ORIENT_SEXUAL",
"SEXO"
)
DatosCualiIntra<-Tabla1[,Var_cuali_intra]
DatosCualiIntra[]<-lapply(DatosCualiIntra, as.factor)
kable(head(DatosCualiIntra, 10))
#| code-fold: show
#| label: acmIntracarcelario
acmIntra <- MCA(DatosCualiIntra, graph=FALSE,level.ventil = 0.01,ncp=7)
#| label: screeplotIntra
#| echo: false
screeplot <- fviz_screeplot(acmIntra, addlabels = TRUE, ylim = c(0, 20)) +  ggtitle("Scree Plot") + theme_minimal()+ylab("Porcentaje de varianza explicada")+xlab("Ejes")
## Usando modif.rate() del paquete GDAtools:
# ptau <- modif.rate(acm)$modif[, 1]
## Haciendo las cuentas uno mismo:
s <- ncol(DatosCualiIntra)
l <- acmIntra$eig[acmIntra$eig[,1] > 1/s, 1]
tau <- ( s / (s - 1) )^2 * ( l - (1/s) )^2
ptau <- tau / sum( tau ) * 100
# Creamos un data frame para usar con ggplot2
barplot_df <- data.frame(Indice = factor(1:length(ptau)), Valor = ptau)
# Creamos el gráfico de barras con ggplot2
barplot_gg <- ggplot(barplot_df, aes(x = Indice, y = Valor)) +
geom_bar(stat = "identity", fill = "darkred") +
ylim(0, max(barplot_df$Valor+10)) +
labs(x = "Ejes", y = expression(tau(lambda))) +
theme_minimal() +
ggtitle("Criterio de Benzécri")
grid.arrange(screeplot, barplot_gg, ncol = 1)
#| label: Tabla-benzecriintra
#| echo: false
#| warning: false
#| output: true
kable(barplot_df[1:5,])
#| label: seleccionejes
#| code-fold: show
Y<-acmIntra$ind$coord[,1:3]
#| label: Preagrupamieto
#| code-fold: show
#| fig-cap: ''
#| fig-align: 'center'
#| fig-width: 5
#| fig-height: 5.5
set.seed(1311) #Fijamos la semilla
pregroup<- kmeans(Y, centers = 5000)  #Agrupamos los datos en 5000 grupos
#| label: jerarquico
#| fig-cap: ''
#| fig-align: 'center'
#| fig-width: 5
#| fig-height: 5.5
#| echo: false
hclCafe <- ward.cluster(dista=dist(pregroup$centers), h.clust=1) # función de FactoClass
plot(hclCafe, las=1, col="darkblue", main="", sub="", xlab="")
abline(h=seq(0, 7, 0.5), col="gray90", lty=3)
#| label: numero-grupos
#| code-fold: show
grupos_jerarquicos <- cutree(hclCafe, k=4)
#| label: consolidacion
#| code-fold: true
set.seed(1311) #Fijamos semilla
centros_de_gravedad <- aggregate(pregroup$centers, by = list(grupos_jerarquicos), FUN = mean) #Calculamos los centros de gravedad obtenidos para los 5000 grupos
kmeans_consolidacion <- kmeans(pregroup$centers, centers = centros_de_gravedad[, -1]) #Iniciamos kmeans con los centros de gravedad calculados
ordenados <- order(rowSums(kmeans_consolidacion$centers))
# Crear una nueva asignación de grupos reordenada
consolidacion <- match(kmeans_consolidacion$cluster, ordenados)
Grupos<-consolidacion[pregroup$cluster] #Obtenemos los grupos finales
#Grupos<-kmeans_consolidacion$cluster[pregroup$cluster] #Obtenemos los grupos finales
#| label: AsignacionGrupos
#| echo: false
Y<-as.data.frame(Y)
Y[["GrupoFinal"]]<-as.factor(Grupos)
DatosCualiIntra<-cbind(DatosCualiIntra,Y["GrupoFinal"])
Tabla1<-cbind(Tabla1,Y["GrupoFinal"])
valores_test<-cluster.carac(DatosCualiIntra[,1:21], DatosCualiIntra$GrupoFinal)
#| label: PorcentajesGrupos
#| echo: false
kable(table(DatosCualiIntra$GrupoFinal)/nrow(DatosCualiIntra)*100)
#| label: valuest grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["1"]]) %>% kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo2
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["2"]])%>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo3
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["3"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["4"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: graficoperfilessexo
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$SEXO)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesagua
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_AGUA_POTABLE)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilescelda
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CAR_PERSONAS_CELDA)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesEjercicio
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CARCEL_LECTURA)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesVentanas
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_VENTANAS)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesTipoCarcel
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIPO_CARCEL)
plotct(tc, "row", col=1+(1:ncol(tc)))
#| label: graficoperfilesTiempoCarcel
#| echo: false
tc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIEMPO_CARCEL)
plotct(tc, "row", col=1+(1:ncol(tc)))
varCuantitativas<-c("EDAD","NUM_HIJOS","EDAD_ESCOLARIDAD","EDAD_CONSUMO_TABACO","EDAD_CONSUMO_ALCOHOL","EDAD_CONSUMO_MARIHUANA","EDAD_CONSUMO_INHALABLES","EDAD_CONSUMO_LSD","EDAD_CONSUMO_HONGOS","EDAD_CONSUMO_COCAINA","EDAD_CONSUMO_PASTA_COCAINA","EDAD_CONSUMO_CRACK","EDAD_CONSUMO_HEROINA","EDAD_CONSUMO_CHOCHOS","EDAD_CONSUMO_TRANQUILIZANTES","EDAD_CONSUMO_ANFETAMINAS","N_PERSONAS_DEPENDIENTES","DINERO_SOBORNO","DELITOS_ABIERTOS","TIEMPO_RECLUIDO","TIEMPO_PROCESO","CANTIDAD_PERSONAS_CELDA","CELDA_HORAS","VECES_SENTENCIADO")
varCualitativas<-setdiff(colnames(Tabla1),c("ID_PER","NOM_ENT",varCuantitativas))
varCualitativas<-setdiff(varCualitativas,colnames(DatosCualiIntra))
varCuantitativas<-c("EDAD","NUM_HIJOS","EDAD_ESCOLARIDAD","N_PERSONAS_DEPENDIENTES","DINERO_SOBORNO","DELITOS_ABIERTOS","CELDA_HORAS","VECES_SENTENCIADO")
DatosCuantitativos<-Tabla1[,c(varCuantitativas,"GrupoFinal")]
DatosCualitativos<-Tabla1[,c(varCualitativas,"GrupoFinal")]
#| label: valuest cuali
#| message: false
#| echo: false
#| warning: false
#| output: true
Val_test_Cuanti<-cluster.carac(DatosCuantitativos[,1:8], DatosCuantitativos$GrupoFinal, tipo.v = "co",
v.lim = 2, dn = 2, dm = 2, neg = TRUE)
#| label: valuestCuanti grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["1"]]) %>% kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuestCuanti grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["1"]]) %>% kable_styling("striped", full_width = T)
#| label: valuestCuanti grupo2
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["2"]])%>%kable_styling("striped", full_width = T)
#| label: valuest grupo3
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["3"]]) %>%kable_styling("striped", full_width = T)
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuanti[["4"]]) %>%kable_styling("striped", full_width = T)
#| label: valuestCuali2
#| message: false
#| echo: false
#| warning: false
#| output: true
Val_test_Cuali2<-cluster.carac(DatosCualitativos[,1:59], DatosCualitativos$GrupoFinal)
#| label: valuestCuali2 grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["1"]]) %>% kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuestCuanti grupo2
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["2"]])%>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: otrasvariables
#| message: false
#| echo: false
#| warning: false
#| output: true
#|
varCuantitativas<-c("EDAD","NUM_HIJOS","EDAD_ESCOLARIDAD","EDAD_CONSUMO_TABACO","EDAD_CONSUMO_ALCOHOL","EDAD_CONSUMO_MARIHUANA","EDAD_CONSUMO_INHALABLES","EDAD_CONSUMO_LSD","EDAD_CONSUMO_HONGOS","EDAD_CONSUMO_COCAINA","EDAD_CONSUMO_PASTA_COCAINA","EDAD_CONSUMO_CRACK","EDAD_CONSUMO_HEROINA","EDAD_CONSUMO_CHOCHOS","EDAD_CONSUMO_TRANQUILIZANTES","EDAD_CONSUMO_ANFETAMINAS","N_PERSONAS_DEPENDIENTES","DINERO_SOBORNO","DELITOS_ABIERTOS","TIEMPO_RECLUIDO","TIEMPO_PROCESO","CANTIDAD_PERSONAS_CELDA","CELDA_HORAS","VECES_SENTENCIADO")
varCualitativas<-setdiff(colnames(Tabla1),c("ID_PER","NOM_ENT",varCuantitativas,"CONSUMO_TABACO","CONSUMO_ALCOHOL","CONSUMO_MARIHUANA","CONSUMO_INHALABLES","CONSUMO_LSD","CONSUMO_HONGOS","CONSUMO_COCAINA","CONSUMO_PASTA_COCAINA","CONSUMO_CRACK","CONSUMO_HEROINA","CONSUMO_CHOCHOS","CONSUMO_TRANQUILIZANTES","CONSUMO_ANFETAMINAS"))
varCualitativas<-setdiff(varCualitativas,colnames(DatosCualiIntra))
varCuantitativas<-c("EDAD","NUM_HIJOS","EDAD_ESCOLARIDAD","N_PERSONAS_DEPENDIENTES","DINERO_SOBORNO","DELITOS_ABIERTOS","CELDA_HORAS","VECES_SENTENCIADO")
DatosCuantitativos<-Tabla1[,c(varCuantitativas,"GrupoFinal")]
DatosCualitativos<-Tabla1[,c(varCualitativas,"GrupoFinal")]
View(DatosCualitativos)
#| label: valuestCuali2
#| message: false
#| echo: false
#| warning: false
#| output: true
Val_test_Cuali2<-cluster.carac(DatosCualitativos[,1:48], DatosCualitativos$GrupoFinal)
#| label: valuestCuali2
#| message: false
#| echo: false
#| warning: false
#| output: true
Val_test_Cuali2<-cluster.carac(DatosCualitativos[,1:46], DatosCualitativos$GrupoFinal)
#| label: valuestCuali2
#| message: false
#| echo: false
#| warning: false
#| output: true
Val_test_Cuali2<-cluster.carac(DatosCualitativos[,1:46], DatosCualitativos$GrupoFinal)
#| label: valuestCuali2 grupo1
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["1"]]) %>% kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuestCuanti grupo2
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["2"]])%>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo3
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["3"]]) %>%kable_styling("striped", full_width = T)  %>%
scroll_box(height = "500px")
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["4"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo3
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["3"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo3
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["3"]]) %>%kable_styling("striped", full_width = T)  %>%
scroll_box(height = "500px")
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(valores_test[["4"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
#| label: valuest grupo4
#| message: false
#| echo: false
#| warning: false
#| output: true
kable(Val_test_Cuali2[["4"]]) %>%kable_styling("striped", full_width = T) %>%
scroll_box(height = "500px")
13.40+5.87+14.59+66.63
13.40+5.87+14.6+66.63
13.40+5.87+14.6+66.6
13.40+5.86+14.6+66.6
13.40+5.87+14.59+66.13
13.40+5.87+14.6+66.13
shiny::runApp('~/GitHub/Analisis-Descriptivo-de-la-Poblacion-Carcelaria-Mexicana/analisisbivariado')
runApp('~/GitHub/Analisis-Descriptivo-de-la-Poblacion-Carcelaria-Mexicana/CorrespondenciaSimples')
runApp('~/GitHub/Analisis-Descriptivo-de-la-Poblacion-Carcelaria-Mexicana/analisisbivariado')
runApp('~/GitHub/Analisis-Descriptivo-de-la-Poblacion-Carcelaria-Mexicana/CorrespondenciaSimples')
