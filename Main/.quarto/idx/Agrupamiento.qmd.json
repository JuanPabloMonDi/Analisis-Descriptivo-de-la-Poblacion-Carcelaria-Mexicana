{"title":"Agrupamiento","markdown":{"yaml":{"title":"Agrupamiento","format":"html","editor":"source"},"headingText":"Paso 1: Análisis factorial (ACM)","containsRefs":false,"markdown":"\n\nFinalmente, para concluir el análisis estadístico de nuestro estudio,agruparemos a los individuos a partir de sus características, con el fin de encontrar patrones en la población encuestada. \n\nPara el agrupamiento de los individuos, se utilizará el método jerárquico de Ward y el método de Kmeans. Al igual que en los análisis de ACP y ACM. Utilizaremos los siguientes paquetes de R para realizar el análisis estadístico.\n\n```{r}\n#| label: carga-librerias\n#| message: false\n#| code-fold: true\n#| output: false\n\n#Manejo de datos\nlibrary(tidyverse)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(readxl)\n#Gráficos\nlibrary(ggplot2)\nlibrary(gridExtra)\nlibrary(plotly)\nlibrary(GGally)\n#ACP\nlibrary(ade4)\nlibrary(FactoClass)\nlibrary(FactoMineR)\nlibrary(factoextra)\n#Datos importados\nsource(\"DatosSeleccionados.R\")\n\n#Ajustes de tema del documento y graficos\nlibrary(scales)\nlibrary(DT)\nlibrary(gt)\nlibrary(RColorBrewer)\ntheme_set(theme_minimal(base_size = 24, base_family = \"Atkinson Hyperlegible\"))\nlibrary(hrbrthemes)\noptions(scipen=999) #Evitar notación científica\n```\n\n\nEn este caso, nos centraremos únicamente en el análisis factorial que presentó mayores y mejores resultados relacionados con el objetivo de nuestro estudio, es decir, realizaremos el agrupamiento de los individuos basándonos en el análisis de correspondencias múltiples realizado para las variables que presentaron una relación clara con la cantidad de personas con las cuales los individuos comparten celda, los cuales resultaron ser, las variables de vida intracarcelaria.\n\nLa siguiente tabla muestra nuestro conjunto de datos considerado para el ACM y agrupamiento.\n\n```{r}\n#| label: Selección1\n#| echo: false\n#| message: false\n#| warning: false\n#| output: true\n\n#Variables seleccionadas en el ACM\nVar_cuali_intra<-c(\n \"CAR_PERSONAS_CELDA\",\n \"CELDA_VENTANAS\",\n \"CELDA_AGUA_POTABLE\" ,\n \"CELDA_DRENAJE\",\n \"CELDA_LUZ\",\n \"CELDA_DUCHA\" ,\n \"CELDA_SANITARIO\" ,\n \"CELDA_SERVICIO_MEDICO\",\n \"CELDA_ALIMENTOS\",\n \"CARCEL_EJERCICIO\",\n \"CARCEL_LECTURA\" ,\n \"CARCEL_RELIGION\" ,\n \"CARCEL_LLAMADAS\" ,\n \"CARCEL_ESTUDIO\" ,\n \"CARCEL_VISITA\" ,\n \"CELDA_SEGURIDAD\" ,\n \"CARCEL_SEGURIDAD\",\n \"TIPO_CARCEL\",\n \"TIEMPO_CARCEL\",\n \"ORIENT_SEXUAL\",\n \"SEXO\"\n)\n\nDatosCualiIntra<-Tabla1[,Var_cuali_intra]\nDatosCualiIntra[]<-lapply(DatosCualiIntra, as.factor)\nkable(head(DatosCualiIntra, 10))\n```\n\n\n\nLas variables consideradas en el componente de vida intracarcelaria son las siguientes:\n\n-   Sexo de la persona\n-   Orientación sexual de la persona\n-   Acceso a ventanas en la celda\n-   Acceso a agua potable en la celda\n-   Acesso a un sistema de drenaje en la celda\n-   Acceso a luz electrica en la celda\n-   Acceso a una ducha en la celda\n-   Acceso a un sanitario en la celda\n-   Acceso a servicio médico dentro de la celda\n-   Acceso a alimentos gratuitos en la celda\n-   Acceso a espacios de ejercicio en la carcel\n-   Acceso a espacios y/o material de lectura en la carcel\n-   Facilidad de ejercer la religión dentro de la carcel\n-   Puede realizar llamadas dentro de la carcel\n-   Puede continuar con sus estudios dentro de la carcel\n-   Puede recibir visitas dentro de la carcel\n-   Sensación de seguridad en la celda\n-   Sensación de seguridad en la carcel\n-   Tipo de carcel\n-   Cantidad de personas en la celda\n\n\nPosteriormente, realizamos el ACM mediante el siguiente comando\n```{r}\n#| code-fold: show\n#| label: acmIntracarcelario\nacmIntra <- MCA(DatosCualiIntra, graph=FALSE,level.ventil = 0.01,ncp=7)\n```\n\nPara evitar el ruido y distorsión de las categorías \"No sabe/No responde\" utilizamos la técnica de ventilación de variables; esta es implementada mediante el parámetro ``level.ventil=0.01``, el cual disipa el efecto de aquellas categorías que contienen menos del 1% de la población en su respectiva variable cualitativa. \n\nLos resultados de este ACM fueron mostrados previamente en la sección de [Análisis de Correspondencias Múltiples](ACM.qmd).\n\n\n## Paso 2: Seleccionar el número de ejes\n\nPara la selección del número de ejes a considerar en el ACM, utilizaremos el criterio de Benzécri, pues el screeplot tradicional puede verse afectado por la presencia de ejes \"parásitos\".\n\n```{r}\n#| label: screeplotIntra\n#| echo: false\nscreeplot <- fviz_screeplot(acmIntra, addlabels = TRUE, ylim = c(0, 20)) +  ggtitle(\"Scree Plot\") + theme_minimal()+ylab(\"Porcentaje de varianza explicada\")+xlab(\"Ejes\")\n## Usando modif.rate() del paquete GDAtools:\n# ptau <- modif.rate(acm)$modif[, 1]\n## Haciendo las cuentas uno mismo:\ns <- ncol(DatosCualiIntra)\nl <- acmIntra$eig[acmIntra$eig[,1] > 1/s, 1]\ntau <- ( s / (s - 1) )^2 * ( l - (1/s) )^2\nptau <- tau / sum( tau ) * 100\n\n# Creamos un data frame para usar con ggplot2\nbarplot_df <- data.frame(Indice = factor(1:length(ptau)), Valor = ptau)\n\n# Creamos el gráfico de barras con ggplot2\nbarplot_gg <- ggplot(barplot_df, aes(x = Indice, y = Valor)) +\n  geom_bar(stat = \"identity\", fill = \"darkred\") +\n  ylim(0, max(barplot_df$Valor+10)) +\n  labs(x = \"Ejes\", y = expression(tau(lambda))) +\n  theme_minimal() +\n  ggtitle(\"Criterio de Benzécri\")\n\ngrid.arrange(screeplot, barplot_gg, ncol = 1)\n```\n\nAl observar los valores de inercia ajustada por el criterio de Benzécri, obtenemos que los 3 primeros ejes acumulan alrededor del 90% de la inercia de los datos. \n\n```{r}\n#| label: Tabla-benzecriintra\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(barplot_df[1:5,])\n```\n\nPor lo tanto, para nuestro agrupamiento, consideraremos únicamente los 3 primeros ejes de nuestro ACM. Es decir, nuestras variables cuantitativas a agrupar mediante K-means consisten en las coordenadas de los 3 primeros ejes de cada uno de los individuos.\n\n\n```{r}\n#| label: seleccionejes\n#| code-fold: show\nY<-acmIntra$ind$coord[,1:3]\n```\n\n\n## Paso 3: Pre-agrupamiento\n\nDado que contamos con la información de 61449 individuos, es necesario realizar un preagrupamiento de los datos antes del agrupamiento jerárquico. Para esto, implementaremos el método de k-means para obtener 5000 grupos. \n\nEl método de K-means nos ayuda a que, dentro de cada uno de estos 5000 grupos, se posea una inercia mínima. Es decir, que estos los individuos dentro de cada grupo sean \"parecidos\" o próximos según su distancia euclidiana.\n\n```{r}\n#| label: Preagrupamieto\n#| code-fold: show\n#| fig-cap: ''\n#| fig-align: 'center'\n#| fig-width: 5\n#| fig-height: 5.5\nset.seed(1311) #Fijamos la semilla\npregroup<- kmeans(Y, centers = 5000)  #Agrupamos los datos en 5000 grupos\n```\n\n## Paso 4: Agrupamiento Jerárquico\n\nAhora que tenemos 5000 grupos de individuos, realizaremos un agrupamiento jerárquico usando la distancia de Ward entre los centros de gravedad de los 5000 grupos. para esto se utiliza la función ``ward.cluster`` del paquete ``FactoClass``.\n\nAsi, obtenemos el siguiente dendograma de esta agrupación de grupos.\n```\n\nkable(barplot_df[1:5,])\n```\n```{r}\n#| label: jerarquico\n#| fig-cap: ''\n#| fig-align: 'center'\n#| fig-width: 5\n#| fig-height: 5.5\n#| echo: false\n\nhclCafe <- ward.cluster(dista=dist(pregroup$centers), h.clust=1) # función de FactoClass\nplot(hclCafe, las=1, col=\"darkblue\", main=\"\", sub=\"\", xlab=\"\")\nabline(h=seq(0, 7, 0.5), col=\"gray90\", lty=3)\n```\n\n\n\n\n## Paso 5: Número total de grupos\nObservando y analizando el dendograma anterior, se consideraron las ideas de clasificar la población en 4 o 7 grupos.Debido a esto, se hizo la agrupación de los individuos para estas 2 cantidades. \n\nAl final, los 7 grupos resultantes no presentaban diferencias claras en sus categorías. Por lo tanto, se optó por agrupar a la población en 4 grupos, los cuales presentaban diferencias claras entre ellos.\n\nEl corte del árbol y la selección de grupos se realizó mediante el siguiente comando\n\n```{r}\n#| label: numero-grupos\n#| code-fold: show\ngrupos_jerarquicos <- cutree(hclCafe, k=4)\n```\n\n## Paso 6: Consolidación\n\nFinalmente, realizamos nuestro K-means de consolidación a partir de los centros de gravedad obtenidos en el agrupamiento jerárquico. \n\n```{r}\n#| label: consolidacion\n#| code-fold: true\n\nset.seed(1311) #Fijamos semilla \n\ncentros_de_gravedad <- aggregate(pregroup$centers, by = list(grupos_jerarquicos), FUN = mean) #Calculamos los centros de gravedad obtenidos para los 5000 grupos\n\n\nkmeans_consolidacion <- kmeans(pregroup$centers, centers = centros_de_gravedad[, -1]) #Iniciamos kmeans con los centros de gravedad calculados\n\nordenados <- order(rowSums(kmeans_consolidacion$centers))\n\n# Crear una nueva asignación de grupos reordenada\nconsolidacion <- match(kmeans_consolidacion$cluster, ordenados)\n\nGrupos<-consolidacion[pregroup$cluster] #Obtenemos los grupos finales\n#Grupos<-kmeans_consolidacion$cluster[pregroup$cluster] #Obtenemos los grupos finales\n```\n\n## Paso 7: Caracterización\n\nUna vez obtenidos los grupos, realizamos un análisis descriptivo de estos para reconocer las variables que caracterizan a cada uno de estos. \n\nDado que se trata únicamente de variables cualitativas, haremos la caracterización a partir de los valores test y la tabla de perfiles entre los grupos y las demás variables.\n\n```{r}\n#| label: AsignacionGrupos\n#| echo: false\n\nY<-as.data.frame(Y)\nY[[\"GrupoFinal\"]]<-as.factor(Grupos)\nDatosCualiIntra<-cbind(DatosCualiIntra,Y[c(\"GrupoFinal\")])\nvalores_test<-cluster.carac(DatosCualiIntra[,1:21], DatosCualiIntra$GrupoFinal)\n```\n\n\n:::panel-tabset\n\n### Grupo 1\n\n**Valores test**\n```{r}\n#| label: valuest grupo1\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(valores_test[[\"1\"]])\n```\n\n\n### Grupo 2\n**Valores test**\n```{r}\n#| label: valuest grupo2\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\n\nkable(valores_test[[\"2\"]])\n```\n\n### Grupo 3\n\n**Valores test**\n```{r}\n#| label: valuest grupo3\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(valores_test[[\"3\"]])\n```\n\n### Grupo 4\n**Valores test**\n```{r}\n#| label: valuest grupo4\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(valores_test[[\"4\"]])\n```\n\n:::\n\n###  Gráficos\n\n\n::: panel-tabset\n\n\n\n#### Sexo\n```{r}\n#| label: graficoperfilessexo\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$SEXO)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Agua potable\n\n```{r}\n#| label: graficoperfilesagua\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_AGUA_POTABLE)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n\n#### Personas celda\n\n```{r}\n#| label: graficoperfilescelda\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CAR_PERSONAS_CELDA)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Ejercicio\n\n```{r}\n#| label: graficoperfilesEjercicio\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CARCEL_EJERCICIO)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Ventanas\n\n```{r}\n#| label: graficoperfilesVentanas\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_VENTANAS)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Tipo Carcel\n\n```{r}\n#| label: graficoperfilesTipoCarcel\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIPO_CARCEL)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Tiempo Carcel\n\n```{r}\n#| label: graficoperfilesTiempoCarcel\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIEMPO_CARCEL)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n:::\n\n\n\n\n## Paso 8: Proyección de los grupos en los planos factoriales\n\n::: panel-tabset\n\n### Eje 1-2\n\n\n```{r}\n#| label: plano1-2\n#| echo: false\n#| output: true\nfviz_mca_ind(acmIntra,label = \"none\",\n             axes=c(1,2),\n             habillage = Y$GrupoFinal,\n             #col.ind= Y$GrupoFinal,\n             palette = \"jco\",  addEllipses = TRUE,\n             ellipse.type = \"convex\",\n             repel = TRUE) \n```\n\n### Eje 1-3\n\n\n```{r}\n#| label: plano1-3\n#| echo: false\n#| output: true\nfviz_mca_ind(acmIntra,label = \"none\",\n             axes=c(1,3),\n             habillage = Y$GrupoFinal,\n             #col.ind= Y$GrupoFinal,\n             palette = \"jco\",  addEllipses = TRUE,\n             ellipse.type = \"convex\",\n             repel = TRUE) \n```\n\n\n### Eje 2-3\n\n```{r}\n#| label: plano2-3\n#| echo: false\n#| output: true\nfviz_mca_ind(acmIntra,label = \"none\",\n             axes=c(2,3),\n             habillage = Y$GrupoFinal,\n             #col.ind= Y$GrupoFinal,\n             palette = \"jco\",  addEllipses = TRUE,\n             ellipse.type = \"convex\",\n             repel = TRUE) \n```\n\n:::","srcMarkdownNoYaml":"\n\nFinalmente, para concluir el análisis estadístico de nuestro estudio,agruparemos a los individuos a partir de sus características, con el fin de encontrar patrones en la población encuestada. \n\nPara el agrupamiento de los individuos, se utilizará el método jerárquico de Ward y el método de Kmeans. Al igual que en los análisis de ACP y ACM. Utilizaremos los siguientes paquetes de R para realizar el análisis estadístico.\n\n```{r}\n#| label: carga-librerias\n#| message: false\n#| code-fold: true\n#| output: false\n\n#Manejo de datos\nlibrary(tidyverse)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(readxl)\n#Gráficos\nlibrary(ggplot2)\nlibrary(gridExtra)\nlibrary(plotly)\nlibrary(GGally)\n#ACP\nlibrary(ade4)\nlibrary(FactoClass)\nlibrary(FactoMineR)\nlibrary(factoextra)\n#Datos importados\nsource(\"DatosSeleccionados.R\")\n\n#Ajustes de tema del documento y graficos\nlibrary(scales)\nlibrary(DT)\nlibrary(gt)\nlibrary(RColorBrewer)\ntheme_set(theme_minimal(base_size = 24, base_family = \"Atkinson Hyperlegible\"))\nlibrary(hrbrthemes)\noptions(scipen=999) #Evitar notación científica\n```\n\n\nEn este caso, nos centraremos únicamente en el análisis factorial que presentó mayores y mejores resultados relacionados con el objetivo de nuestro estudio, es decir, realizaremos el agrupamiento de los individuos basándonos en el análisis de correspondencias múltiples realizado para las variables que presentaron una relación clara con la cantidad de personas con las cuales los individuos comparten celda, los cuales resultaron ser, las variables de vida intracarcelaria.\n\nLa siguiente tabla muestra nuestro conjunto de datos considerado para el ACM y agrupamiento.\n\n```{r}\n#| label: Selección1\n#| echo: false\n#| message: false\n#| warning: false\n#| output: true\n\n#Variables seleccionadas en el ACM\nVar_cuali_intra<-c(\n \"CAR_PERSONAS_CELDA\",\n \"CELDA_VENTANAS\",\n \"CELDA_AGUA_POTABLE\" ,\n \"CELDA_DRENAJE\",\n \"CELDA_LUZ\",\n \"CELDA_DUCHA\" ,\n \"CELDA_SANITARIO\" ,\n \"CELDA_SERVICIO_MEDICO\",\n \"CELDA_ALIMENTOS\",\n \"CARCEL_EJERCICIO\",\n \"CARCEL_LECTURA\" ,\n \"CARCEL_RELIGION\" ,\n \"CARCEL_LLAMADAS\" ,\n \"CARCEL_ESTUDIO\" ,\n \"CARCEL_VISITA\" ,\n \"CELDA_SEGURIDAD\" ,\n \"CARCEL_SEGURIDAD\",\n \"TIPO_CARCEL\",\n \"TIEMPO_CARCEL\",\n \"ORIENT_SEXUAL\",\n \"SEXO\"\n)\n\nDatosCualiIntra<-Tabla1[,Var_cuali_intra]\nDatosCualiIntra[]<-lapply(DatosCualiIntra, as.factor)\nkable(head(DatosCualiIntra, 10))\n```\n\n## Paso 1: Análisis factorial (ACM)\n\n\nLas variables consideradas en el componente de vida intracarcelaria son las siguientes:\n\n-   Sexo de la persona\n-   Orientación sexual de la persona\n-   Acceso a ventanas en la celda\n-   Acceso a agua potable en la celda\n-   Acesso a un sistema de drenaje en la celda\n-   Acceso a luz electrica en la celda\n-   Acceso a una ducha en la celda\n-   Acceso a un sanitario en la celda\n-   Acceso a servicio médico dentro de la celda\n-   Acceso a alimentos gratuitos en la celda\n-   Acceso a espacios de ejercicio en la carcel\n-   Acceso a espacios y/o material de lectura en la carcel\n-   Facilidad de ejercer la religión dentro de la carcel\n-   Puede realizar llamadas dentro de la carcel\n-   Puede continuar con sus estudios dentro de la carcel\n-   Puede recibir visitas dentro de la carcel\n-   Sensación de seguridad en la celda\n-   Sensación de seguridad en la carcel\n-   Tipo de carcel\n-   Cantidad de personas en la celda\n\n\nPosteriormente, realizamos el ACM mediante el siguiente comando\n```{r}\n#| code-fold: show\n#| label: acmIntracarcelario\nacmIntra <- MCA(DatosCualiIntra, graph=FALSE,level.ventil = 0.01,ncp=7)\n```\n\nPara evitar el ruido y distorsión de las categorías \"No sabe/No responde\" utilizamos la técnica de ventilación de variables; esta es implementada mediante el parámetro ``level.ventil=0.01``, el cual disipa el efecto de aquellas categorías que contienen menos del 1% de la población en su respectiva variable cualitativa. \n\nLos resultados de este ACM fueron mostrados previamente en la sección de [Análisis de Correspondencias Múltiples](ACM.qmd).\n\n\n## Paso 2: Seleccionar el número de ejes\n\nPara la selección del número de ejes a considerar en el ACM, utilizaremos el criterio de Benzécri, pues el screeplot tradicional puede verse afectado por la presencia de ejes \"parásitos\".\n\n```{r}\n#| label: screeplotIntra\n#| echo: false\nscreeplot <- fviz_screeplot(acmIntra, addlabels = TRUE, ylim = c(0, 20)) +  ggtitle(\"Scree Plot\") + theme_minimal()+ylab(\"Porcentaje de varianza explicada\")+xlab(\"Ejes\")\n## Usando modif.rate() del paquete GDAtools:\n# ptau <- modif.rate(acm)$modif[, 1]\n## Haciendo las cuentas uno mismo:\ns <- ncol(DatosCualiIntra)\nl <- acmIntra$eig[acmIntra$eig[,1] > 1/s, 1]\ntau <- ( s / (s - 1) )^2 * ( l - (1/s) )^2\nptau <- tau / sum( tau ) * 100\n\n# Creamos un data frame para usar con ggplot2\nbarplot_df <- data.frame(Indice = factor(1:length(ptau)), Valor = ptau)\n\n# Creamos el gráfico de barras con ggplot2\nbarplot_gg <- ggplot(barplot_df, aes(x = Indice, y = Valor)) +\n  geom_bar(stat = \"identity\", fill = \"darkred\") +\n  ylim(0, max(barplot_df$Valor+10)) +\n  labs(x = \"Ejes\", y = expression(tau(lambda))) +\n  theme_minimal() +\n  ggtitle(\"Criterio de Benzécri\")\n\ngrid.arrange(screeplot, barplot_gg, ncol = 1)\n```\n\nAl observar los valores de inercia ajustada por el criterio de Benzécri, obtenemos que los 3 primeros ejes acumulan alrededor del 90% de la inercia de los datos. \n\n```{r}\n#| label: Tabla-benzecriintra\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(barplot_df[1:5,])\n```\n\nPor lo tanto, para nuestro agrupamiento, consideraremos únicamente los 3 primeros ejes de nuestro ACM. Es decir, nuestras variables cuantitativas a agrupar mediante K-means consisten en las coordenadas de los 3 primeros ejes de cada uno de los individuos.\n\n\n```{r}\n#| label: seleccionejes\n#| code-fold: show\nY<-acmIntra$ind$coord[,1:3]\n```\n\n\n## Paso 3: Pre-agrupamiento\n\nDado que contamos con la información de 61449 individuos, es necesario realizar un preagrupamiento de los datos antes del agrupamiento jerárquico. Para esto, implementaremos el método de k-means para obtener 5000 grupos. \n\nEl método de K-means nos ayuda a que, dentro de cada uno de estos 5000 grupos, se posea una inercia mínima. Es decir, que estos los individuos dentro de cada grupo sean \"parecidos\" o próximos según su distancia euclidiana.\n\n```{r}\n#| label: Preagrupamieto\n#| code-fold: show\n#| fig-cap: ''\n#| fig-align: 'center'\n#| fig-width: 5\n#| fig-height: 5.5\nset.seed(1311) #Fijamos la semilla\npregroup<- kmeans(Y, centers = 5000)  #Agrupamos los datos en 5000 grupos\n```\n\n## Paso 4: Agrupamiento Jerárquico\n\nAhora que tenemos 5000 grupos de individuos, realizaremos un agrupamiento jerárquico usando la distancia de Ward entre los centros de gravedad de los 5000 grupos. para esto se utiliza la función ``ward.cluster`` del paquete ``FactoClass``.\n\nAsi, obtenemos el siguiente dendograma de esta agrupación de grupos.\n```\n\nkable(barplot_df[1:5,])\n```\n```{r}\n#| label: jerarquico\n#| fig-cap: ''\n#| fig-align: 'center'\n#| fig-width: 5\n#| fig-height: 5.5\n#| echo: false\n\nhclCafe <- ward.cluster(dista=dist(pregroup$centers), h.clust=1) # función de FactoClass\nplot(hclCafe, las=1, col=\"darkblue\", main=\"\", sub=\"\", xlab=\"\")\nabline(h=seq(0, 7, 0.5), col=\"gray90\", lty=3)\n```\n\n\n\n\n## Paso 5: Número total de grupos\nObservando y analizando el dendograma anterior, se consideraron las ideas de clasificar la población en 4 o 7 grupos.Debido a esto, se hizo la agrupación de los individuos para estas 2 cantidades. \n\nAl final, los 7 grupos resultantes no presentaban diferencias claras en sus categorías. Por lo tanto, se optó por agrupar a la población en 4 grupos, los cuales presentaban diferencias claras entre ellos.\n\nEl corte del árbol y la selección de grupos se realizó mediante el siguiente comando\n\n```{r}\n#| label: numero-grupos\n#| code-fold: show\ngrupos_jerarquicos <- cutree(hclCafe, k=4)\n```\n\n## Paso 6: Consolidación\n\nFinalmente, realizamos nuestro K-means de consolidación a partir de los centros de gravedad obtenidos en el agrupamiento jerárquico. \n\n```{r}\n#| label: consolidacion\n#| code-fold: true\n\nset.seed(1311) #Fijamos semilla \n\ncentros_de_gravedad <- aggregate(pregroup$centers, by = list(grupos_jerarquicos), FUN = mean) #Calculamos los centros de gravedad obtenidos para los 5000 grupos\n\n\nkmeans_consolidacion <- kmeans(pregroup$centers, centers = centros_de_gravedad[, -1]) #Iniciamos kmeans con los centros de gravedad calculados\n\nordenados <- order(rowSums(kmeans_consolidacion$centers))\n\n# Crear una nueva asignación de grupos reordenada\nconsolidacion <- match(kmeans_consolidacion$cluster, ordenados)\n\nGrupos<-consolidacion[pregroup$cluster] #Obtenemos los grupos finales\n#Grupos<-kmeans_consolidacion$cluster[pregroup$cluster] #Obtenemos los grupos finales\n```\n\n## Paso 7: Caracterización\n\nUna vez obtenidos los grupos, realizamos un análisis descriptivo de estos para reconocer las variables que caracterizan a cada uno de estos. \n\nDado que se trata únicamente de variables cualitativas, haremos la caracterización a partir de los valores test y la tabla de perfiles entre los grupos y las demás variables.\n\n```{r}\n#| label: AsignacionGrupos\n#| echo: false\n\nY<-as.data.frame(Y)\nY[[\"GrupoFinal\"]]<-as.factor(Grupos)\nDatosCualiIntra<-cbind(DatosCualiIntra,Y[c(\"GrupoFinal\")])\nvalores_test<-cluster.carac(DatosCualiIntra[,1:21], DatosCualiIntra$GrupoFinal)\n```\n\n\n:::panel-tabset\n\n### Grupo 1\n\n**Valores test**\n```{r}\n#| label: valuest grupo1\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(valores_test[[\"1\"]])\n```\n\n\n### Grupo 2\n**Valores test**\n```{r}\n#| label: valuest grupo2\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\n\nkable(valores_test[[\"2\"]])\n```\n\n### Grupo 3\n\n**Valores test**\n```{r}\n#| label: valuest grupo3\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(valores_test[[\"3\"]])\n```\n\n### Grupo 4\n**Valores test**\n```{r}\n#| label: valuest grupo4\n#| message: false\n#| echo: false\n#| warning: false\n#| output: true\n\nkable(valores_test[[\"4\"]])\n```\n\n:::\n\n###  Gráficos\n\n\n::: panel-tabset\n\n\n\n#### Sexo\n```{r}\n#| label: graficoperfilessexo\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$SEXO)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Agua potable\n\n```{r}\n#| label: graficoperfilesagua\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_AGUA_POTABLE)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n\n#### Personas celda\n\n```{r}\n#| label: graficoperfilescelda\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CAR_PERSONAS_CELDA)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Ejercicio\n\n```{r}\n#| label: graficoperfilesEjercicio\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CARCEL_EJERCICIO)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Ventanas\n\n```{r}\n#| label: graficoperfilesVentanas\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$CELDA_VENTANAS)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Tipo Carcel\n\n```{r}\n#| label: graficoperfilesTipoCarcel\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIPO_CARCEL)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n#### Tiempo Carcel\n\n```{r}\n#| label: graficoperfilesTiempoCarcel\n#| echo: false\ntc<-table(DatosCualiIntra$GrupoFinal,DatosCualiIntra$TIEMPO_CARCEL)\n\n    plotct(tc, \"row\", col=1+(1:ncol(tc)))\n\n```\n\n:::\n\n\n\n\n## Paso 8: Proyección de los grupos en los planos factoriales\n\n::: panel-tabset\n\n### Eje 1-2\n\n\n```{r}\n#| label: plano1-2\n#| echo: false\n#| output: true\nfviz_mca_ind(acmIntra,label = \"none\",\n             axes=c(1,2),\n             habillage = Y$GrupoFinal,\n             #col.ind= Y$GrupoFinal,\n             palette = \"jco\",  addEllipses = TRUE,\n             ellipse.type = \"convex\",\n             repel = TRUE) \n```\n\n### Eje 1-3\n\n\n```{r}\n#| label: plano1-3\n#| echo: false\n#| output: true\nfviz_mca_ind(acmIntra,label = \"none\",\n             axes=c(1,3),\n             habillage = Y$GrupoFinal,\n             #col.ind= Y$GrupoFinal,\n             palette = \"jco\",  addEllipses = TRUE,\n             ellipse.type = \"convex\",\n             repel = TRUE) \n```\n\n\n### Eje 2-3\n\n```{r}\n#| label: plano2-3\n#| echo: false\n#| output: true\nfviz_mca_ind(acmIntra,label = \"none\",\n             axes=c(2,3),\n             habillage = Y$GrupoFinal,\n             #col.ind= Y$GrupoFinal,\n             palette = \"jco\",  addEllipses = TRUE,\n             ellipse.type = \"convex\",\n             repel = TRUE) \n```\n\n:::"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Agrupamiento.html"},"language":{"toc-title-document":"Tabla de contenidos","toc-title-website":"En esta página","related-formats-title":"Otros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fuente","other-links-title":"Otros Enlaces","code-links-title":"Enlaces de código","launch-dev-container-title":"Iniciar Dev Container","launch-binder-title":"Iniciar Binder","article-notebook-label":"Cuaderno de Artículo","notebook-preview-download":"Descargar Cuaderno","notebook-preview-download-src":"Descargar código fuente","notebook-preview-back":"Volver al Artículo","manuscript-meca-bundle":"Archivo MECA","section-title-abstract":"Resumen","section-title-appendices":"Apéndices","section-title-footnotes":"Notas","section-title-references":"Referencias","section-title-reuse":"Reutilización","section-title-copyright":"Derechos de autor","section-title-citation":"Cómo citar","appendix-attribution-cite-as":"Por favor, cita este trabajo como:","appendix-attribution-bibtex":"BibTeX","title-block-author-single":"Autor/a","title-block-author-plural":"Autores/as","title-block-affiliation-single":"Afiliación","title-block-affiliation-plural":"Afiliaciones","title-block-published":"Fecha de publicación","title-block-modified":"Fecha de modificación","title-block-keywords":"Palabras clave","callout-tip-title":"Tip","callout-note-title":"Nota","callout-warning-title":"Advertencia","callout-important-title":"Importante","callout-caution-title":"Precaución","code-summary":"Código","code-tools-menu-caption":"Código","code-tools-show-all-code":"Mostrar todo el código","code-tools-hide-all-code":"Ocultar todo el código","code-tools-view-source":"Ver el código fuente","code-tools-source-code":"Ejecutar el código","tools-share":"Compartir","tools-download":"Descargar","code-line":"Línea","code-lines":"Líneas","copy-button-tooltip":"Copiar al portapapeles","copy-button-tooltip-success":"Copiado","repo-action-links-edit":"Editar esta página","repo-action-links-source":"Ver el código","repo-action-links-issue":"Informar de un problema","back-to-top":"Volver arriba","search-no-results-text":"Sin resultados","search-matching-documents-text":"documentos encontrados","search-copy-link-title":"Copiar el enlace en la búsqueda","search-hide-matches-text":"Ocultar resultados adicionales","search-more-match-text":"resultado adicional en este documento","search-more-matches-text":"resultados adicionales en este documento","search-clear-button-title":"Borrar","search-text-placeholder":"","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Buscar","toggle-section":"Alternar sección","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo oscuro","toggle-reader-mode":"Alternar modo lector","toggle-navigation":"Navegación de palanca","crossref-fig-title":"Figura","crossref-tbl-title":"Tabla","crossref-lst-title":"Listado","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corolario","crossref-prp-title":"Proposición","crossref-cnj-title":"Conjetura","crossref-def-title":"Definición","crossref-exm-title":"Ejemplo","crossref-exr-title":"Ejercicio","crossref-ch-prefix":"Capítulo","crossref-apx-prefix":"Apéndice","crossref-sec-prefix":"Sección","crossref-eq-prefix":"Ecuación","crossref-lof-title":"Listado de Figuras","crossref-lot-title":"Listado de Tablas","crossref-lol-title":"Listado de Listados","environment-proof-title":"Prueba","environment-remark-title":"Observación","environment-solution-title":"Solución","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Por defecto","listing-page-order-by-date-asc":"Menos reciente","listing-page-order-by-date-desc":"Más reciente","listing-page-order-by-number-desc":"De mayor a menor","listing-page-order-by-number-asc":"De menor a mayor","listing-page-field-date":"Fecha","listing-page-field-title":"Título","listing-page-field-description":"Descripción","listing-page-field-author":"Autor/a","listing-page-field-filename":"Nombre de archivo","listing-page-field-filemodified":"Fecha de modificación","listing-page-field-subtitle":"Subtítulo","listing-page-field-readingtime":"Tiempo de lectura","listing-page-field-wordcount":"Conteo de Palabras","listing-page-field-categories":"Categorías","listing-page-minutes-compact":"{0} minutos","listing-page-category-all":"Todas","listing-page-no-matches":"No hay resultados","listing-page-words":"{0} palabras"},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.4.549","editor":"source","theme":{"light":"simplex","dark":"slate"},"toc-expand":2,"toc-title":"Tabla de contenidos","toc-location":"right","title":"Agrupamiento"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}